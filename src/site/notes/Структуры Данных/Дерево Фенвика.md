---
{"dg-publish":true,"permalink":"/struktury-dannyh/derevo-fenvika/"}
---

–≠—Ç–æ —Ç–∞–∫–∞—è [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–ó–∞–ø—Ä–æ—Å–Ω–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞\|–∑–∞–ø—Ä–æ—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞]], –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞ `O(1)`, –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ –∏ –∏–∑–º–µ–Ω—è—Ç—å –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤–µ.

–î–µ—Ä–µ–≤–æ –Ω–∞–∏–∑–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª $[0; r)$ –¥–ª—è –ª—é–±—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π , –≥–¥–µ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –µ—Å–ª–∏ –µ—â—ë —É —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª, —Ç–æ –º–æ–∂–Ω–æ –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ $[l; r)$, –ø—Ä–æ—Å—Ç–æ —É $[0; r)$ –æ—Ç–º–µ–Ω–∏—Ç—å $[0; l)$

# –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞, –∫–∞–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –¥–≤—É—Ö –±–æ–ª–µ–µ –º–∞–ª–µ–Ω—å–∫–∏—Ö –æ—Ç—Ä–µ–∑–∫–∞—Ö.  –ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –¥—Ä—É–≥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞.

–¢–æ –µ—Å—Ç—å –Ω—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `f`, –∫–æ—Ç–æ—Ä–∞—è –±–µ—Ä—ë—Ç `i` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `p`, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –º–∞—Å—Å–∏–≤–µ, –∏ –æ—Ç –∫–æ—Ç–æ—Ä–æ–π –Ω—É–∂–Ω–æ –≤—ã—á–µ—Å—Ç—å —Ç–æ–∂–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞ `p` –Ω–µ –±—É–¥–µ—Ç —Ä–∞–≤–Ω–æ –Ω—É–ª—é, –∞ –µ—â—ë –Ω—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `g` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 

–¢.–µ. –≤–æ—Ç —Ç–∞–∫–∞—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ `[0; r]`, (–≤–∞–∂–Ω–æ, —á—Ç–æ –≤—Ç–æ—Ä–∞—è —Å–∫–æ–±–∫–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω–∞—è)

> $s(r) = 0$, –ø—Ä–∏. $r \leq 0$
> $s(r) = t_r + s(f(r) - 1)$

–ó–∞–º–µ–Ω–∏—Ç–µ `+` –∏ `0`
–í–æ–∑–º–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `f`:

- `i & -i`
- `i & (i+1)`

# –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ü§®

–≠—Ç–æ –∫—Ä—É—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ *(–∞)* –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç 0 –¥–æ `r`, –ø—Ä–∏—á—ë–º –ø–æ—Ñ–∏–≥ –Ω–∞ `f` *(–±)* –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã (—Ç–∏–ø–æ `+`, `-`) –∏ –∏–∑–º–µ–Ω—è—Ç—å 1 —ç–ª–µ–º–µ–Ω—Ç.

–ï—Å–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å –Ω–µ –Ω–∞–¥–æ, —Ç–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–ü—Ä–µ—Ñ–∏–∫—Å–Ω–∞—è —Å—É–º–º–∞\|–ü—Ä–µ—Ñ–∏–∫—Å–Ω–∞—è —Å—É–º–º–∞]] , –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—ë –∑–∞–∫–æ–¥–∏—Ç—å –ø–æ–ª–µ–≥—á–µ.  –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω—É–∂–Ω—ã –Ω–∞ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, —Ç–æ —é–∑–∞–π—Ç–µ [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–î–µ—Ä–µ–≤–æ –û—Ç—Ä–µ–∑–∫–æ–≤\|–î–µ—Ä–µ–≤–æ –û—Ç—Ä–µ–∑–∫–æ–≤]]

# –ö–æ–¥


```cpp
#include <iostream>
#include <vector>

using namespace std;

vector<int> a = {1, 2, 3, 4};
const int n = a.size();

vector<int> t(n + 1);

void inc(int k, int x) {
  k++;
  for (; k <= n; k += k & -k)
    t[k] += x;
}

void build() {
  for (int i = 0; i < n; i++)
    inc(i, a[i]);
}

// sum on [0; r)
int query(int r) {
  int ans = 0;
  while (r > 0) {
    ans += t[r];
    r -= r & -r;
  }
  return ans;
}

// sum on [l; r)
inline int query(int l, int r) { return query(r) - query(l); }

int main() {
  build();

  cout << "Arr: ";
  for (auto x : a)
    cout << x << ' ';
  cout << '\n';

  cout << "sum[0, 4) = " << query(4) << endl;
  cout << "sum[1, 3) = " << query(1, 3) << endl;

  return 0;
}
```

# –°—Å—ã–ª–∫–∏ üß†

- https://ru.algorithmica.org/cs/range-queries/fenwick/
