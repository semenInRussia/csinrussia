---
{"dg-publish":true,"permalink":"/struktury-dannyh/derevo-fenvika/"}
---

–≠—Ç–æ —Ç–∞–∫–∞—è [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–ó–∞–ø—Ä–æ—Å–Ω–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞\|–∑–∞–ø—Ä–æ—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞]], –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞ `O(1)`, –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ –∏ –∏–∑–º–µ–Ω—è—Ç—å –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤–µ.

–î–µ—Ä–µ–≤–æ –Ω–∞–∏–∑–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª $[0; r)$ –¥–ª—è –ª—é–±—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π , –≥–¥–µ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –µ—Å–ª–∏ –µ—â—ë —É —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª, —Ç–æ –º–æ–∂–Ω–æ –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ $[l; r)$, –ø—Ä–æ—Å—Ç–æ —É $[0; r)$ –æ—Ç–º–µ–Ω–∏—Ç—å $[0; l)$

# –û–ø–∏—Å–∞–Ω–∏–µ

–ò–¥–µ—è **–Ω–µ** –ø—Ä–æ—Å—Ç–∞—è, –æ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ –æ—Å–Ω–æ–≤–Ω–∞ –Ω–∞ –∏–¥–µ–µ [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–î–µ—Ä–µ–≤–æ –û—Ç—Ä–µ–∑–∫–æ–≤\|–î–µ—Ä–µ–≤–∞ –û—Ç—Ä–µ–∑–∫–æ–≤]].  –°—É—Ç—å –≤ —Ç–æ–º, —á—Ç–æ —É –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –î–µ—Ä–µ–≤–µ –û—Ç—Ä–µ–∑–∫–æ–≤ –µ—Å—Ç—å 2 —Ä–µ–±—ë–Ω–∫–∞.  –ò–¥–µ—è –î–µ—Ä–µ–≤–∞ –û—Ç—Ä–µ–∑–∫–æ–≤ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ —É –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–µ–±—ë–Ω–æ–∫ (–µ–≥–æ –∏–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π $f$), –∞ –æ—Å—Ç–∞–ª—å–Ω–∞—è —Ñ–∏–≥–Ω—è –æ –ø—Ä–∞–≤–æ–º —Ä–µ–±—ë–Ω–∫–µ –≤–º–µ—Å—Ç–µ —Å —Å–∞–º–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º —É–∑–ª–∞ –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∑–ª–∞, —Ç.–µ. –º—ã –∑–∞–º–µ–Ω—è–µ–º –ª–µ–≤–æ–µ –ø–æ–¥–¥–µ—Ä–µ–≤–æ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º —É–∑–ª–∞!

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç $f$, –Ø –≥–æ–≤–æ—Ä–∏—Ç—å –≤–∞–º –∫–æ–Ω–µ—á–Ω–æ –Ω–µ –±—É–¥—É.  –ï—Å–ª–∏ –≤–∞–º –≤–æ—Ç –ø—Ä—è–º –≤–æ—Ç —Ö–æ—á–µ—Ç—Å—è, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—å—é [[–°–∞–π—Ç—ã/algorithmica.org\|algorithmica.org]] (*—Å–º. –Ω–∏–∂–µ —Å—Å—ã–ª–∫—É*).  –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂—É –∫–∞–∫–∏–µ $f$ –≤—Å–µ–º–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã:

- `i & -i`
- `i & (i+1)`

# –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ü§®

–≠—Ç–æ –∫—Ä—É—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ *(–∞)* –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç 0 –¥–æ `r`, –ø—Ä–∏—á—ë–º –ø–æ—Ñ–∏–≥ –Ω–∞ `f` *(–±)* –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã (—Ç–∏–ø–æ `+`, `-`) –∏ –∏–∑–º–µ–Ω—è—Ç—å 1 —ç–ª–µ–º–µ–Ω—Ç.

–ï—Å–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å –Ω–µ –Ω–∞–¥–æ, —Ç–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–ü—Ä–µ—Ñ–∏–∫—Å–Ω–∞—è —Å—É–º–º–∞\|–ü—Ä–µ—Ñ–∏–∫—Å–Ω–∞—è —Å—É–º–º–∞]] , –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—ë –∑–∞–∫–æ–¥–∏—Ç—å –ø–æ–ª–µ–≥—á–µ.  –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω—É–∂–Ω—ã –Ω–∞ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, —Ç–æ —é–∑–∞–π—Ç–µ [[–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö/–î–µ—Ä–µ–≤–æ –û—Ç—Ä–µ–∑–∫–æ–≤\|–î–µ—Ä–µ–≤–æ –û—Ç—Ä–µ–∑–∫–æ–≤]]

# –ö–æ–¥


```cpp
#include <iostream>
#include <vector>

using namespace std;

vector<int> a = {1, 2, 3, 4};
const int n = a.size();

vector<int> t(n + 1);

void add(int k, int x) {
  k++;
  for (; k <= n; k += k & -k)
    t[k] += x;
}

void build() {
  for (int i = 0; i < n; i++)
    add(i+1, a[i]);
}

// sum on [0; r)
int query(int r) {
  int ans = 0;
  for (; r > 0; r -= r & -r) {
    ans += t[r];
  }
  return ans;
}

// sum on [l; r)
inline int query(int l, int r) { return query(r) - query(l); }

int main() {
  build();

  cout << "Arr: ";
  for (auto x : a)
    cout << x << ' ';
  cout << '\n';

  cout << "sum[0, 4) = " << query(4) << endl;
  cout << "sum[1, 3) = " << query(1, 3) << endl;

  return 0;
}
```

# –°—Å—ã–ª–∫–∏ üß†

- https://ru.algorithmica.org/cs/range-queries/fenwick/
- https://docs.google.com/document/u/0/d/1OQKS5O-OjvFfhukNQMHONdiE1JD863BNiGF1d-rOAmU/mobilebasic ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç [[–°–∞–π—Ç—ã/–ú–ò–†–≠–ê\|–ú–ò–†–≠–ê]]
- https://youtu.be/LBF056OnlmY?si=qS9D0soDL2q34TpL
